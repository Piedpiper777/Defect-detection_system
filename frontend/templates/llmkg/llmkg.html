{% extends "base.html" %}

{% block title %}问答与图谱可视化 - 工业大模型知识问答系统{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/llmkg.css') }}">
{% endblock %}

{% block content %}
<script id="neo4j-config" type="application/json">
    {{ neo4j_config | default({'serverUrl': 'bolt://localhost:7687', 'serverUser': 'neo4j', 'serverPassword': 'neo4j'}) | tojson | safe }}
</script>
<div class="content-wrapper">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">缺陷检测问答与图谱可视化</h1>
            <p class="page-subtitle">左侧对话、右侧图谱，联动查看知识上下文</p>
        </div>
    </div>

    <div class="split-layout">
        <!-- 左侧：问答 -->
        <div class="card-panel qa-wrapper">
            <div class="panel-header">
                <h3><i class="fas fa-comments" style="margin-right:8px;color:#2F80ED;"></i>问答助手</h3>
            </div>

            <div class="chat-history" id="chatHistory">
                <div class="welcome-message">
                    <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content">
                        <p>您好！这里可以提问缺陷检测相关的问题，同时在右侧查看图谱上下文。</p>
                        <p>输入问题并发送，我会基于知识库给出回答。</p>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <textarea id="questionInput" placeholder="请输入您关于缺陷检测的问题..." rows="3" maxlength="1000"></textarea>
                    <div class="input-controls">
                        <div class="char-count"><span id="charCount">0</span>/1000</div>
                        <button id="sendButton" class="send-btn" disabled><i class="fas fa-paper-plane"></i>发送</button>
                    </div>
                </div>
            </div>

            <div class="loading-indicator" id="loadingIndicator">
                <div class="spinner"></div><span>正在思考中...</span>
            </div>
        </div>

        <!-- 右侧：图谱 -->
        <div class="card-panel graph-panel">
            <div class="panel-header">
                <h3><i class="fas fa-project-diagram" style="margin-right:8px;color:#2F80ED;"></i>图谱可视化</h3>
            </div>

            <div class="viz-controls">
                <input type="text" id="cypherQuery" class="query-input" value="MATCH (n)-[r]->(m) RETURN n,r,m LIMIT 100" placeholder="输入Cypher查询语句...">
                <button id="runQuery" class="btn-viz">执行查询</button>
                <button id="resetView" class="btn-viz secondary">重置视图</button>
                <button id="fitView" class="btn-viz secondary">适应屏幕</button>
            </div>

            <div id="statusMessage" class="status-message"></div>
            <div id="viz"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/neovis.js@2.0.2/dist/neovis.js"></script>
<script src="{{ url_for('static', filename='js/llmkg.js') }}"></script>
{% endblock %}